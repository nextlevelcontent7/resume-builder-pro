function compile(source){
  return function(context={}){
    return source.replace(/{{\s*([^}]+)\s*}}/g,(m,expr)=>{
      const parts=expr.trim().split(/\s+/);
      const key=parts.shift();
      const fn=context[key];
      if(typeof fn==='function'){
        const args=parts.map(p=>context[p]);
        try{ return fn(...args); }catch(e){ return ''; }
      }
      return context[key]!==undefined?context[key]:'';
    });
  };
}
module.exports={compile};
